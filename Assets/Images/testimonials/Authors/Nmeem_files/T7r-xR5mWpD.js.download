if (self.CavalryLogger) { CavalryLogger.start_js(["1tP7AvT"]); }

__d("legacy:popup-resizer",["PopupWindow"],(function(a,b,c,d,e,f){a.PopupResizer=b("PopupWindow")}),3);
__d("upgradedUFI2MentionsComposerPluginCreatorWithTypeaheadViewForDraftjs.experimental",["CometMentions.react","FeedComposerCometMentionsTypeheadListItem.react","Keys","MentionSpan.react","WeakMentionSpan.react","cometReplaceMentionedTextInEditorState","createCometComposerMentionsEntity","createUpgradedUFI2MentionsComposerPluginAnchorDecorator","getCometComposerMentionsSearch","getEntityMatcher","installUFI2ComposerInputDecorators","react","recoverableViolation","upgradedUFI2MentionsComposerPluginDraftUtils","useFeedComposerCometMentionsDataSourceResolver","usePrevious","useUpgradedUFI2MentionsComposerPluginInstaller"],(function(a,b,c,d,e,f){"use strict";e.exports=a;var g,h=g||b("react"),i=b("Keys").DOWN,j=b("Keys").ESC,k=b("Keys").RETURN,l=b("Keys").TAB,m=b("Keys").UP,n={component:b("MentionSpan.react"),strategy:b("getEntityMatcher")(function(a){return a.getType()==="MENTION"})},o={component:b("WeakMentionSpan.react"),strategy:b("getEntityMatcher")(function(a){return a.getType()==="MENTION"?!!((a=a.getData())==null?void 0:a.isWeak):!1})};function a(){return function(){function a(){return h.forwardRef(function(a,c){var d=a.inputProps,e=d.composerState,f=d.onBlur,g=d.onComposerStateChange,q=d.onFocus;d=a.onInstallContentBlockToTextWithEntitiesInputMessageMappers;b("useUpgradedUFI2MentionsComposerPluginInstaller")(d);a=h.useState(!1);d=a[0];var r=a[1],s=h.useRef(null),t=h.useRef(!1);a=h.useState(null);var u=a[0],v=a[1],w=h.useRef(!1),x=b("useFeedComposerCometMentionsDataSourceResolver")({limit:5}),y=b("upgradedUFI2MentionsComposerPluginDraftUtils").getMaybeEditorState(e),z=b("usePrevious")(e);h.useEffect(function(){var a=e.inputState;if(z==null)return;var c=z.inputState;if(a.__type==="editor-state-based"&&(c.__type!=="editor-state-based"||c.__type==="editor-state-based"&&c.editorState!==a.editorState)){c=b("getCometComposerMentionsSearch")(a.editorState);v(c);r(!1)}else return},[e,z]);var A=h.useCallback(function(a){g(function(b){return babelHelpers["extends"]({},b,{ariaInputs:a})})},[g]),B=h.useCallback(function(a){f&&f(a),A()},[f,A]),C=h.useCallback(function(a){q&&q(a)},[q]),D=h.useCallback(function(a,b){var c=s.current;if(a.keyCode===j&&u!=null){t.current&&w.current&&(a.preventDefault(),a.stopPropagation());return"MentionsAutocomplete/cancel"}if(c!=null&&t.current&&w.current)switch(a.keyCode){case i:a.preventDefault();return"MentionsAutocomplete/next-mention";case k:if(c.hasSelection()){a.preventDefault();return"MentionsAutocomplete/select-mention"}break;case l:if(c.hasSelection()){a.preventDefault();return"MentionsAutocomplete/select-mention"}break;case m:a.preventDefault();return"MentionsAutocomplete/previous-mention"}b&&b(a)},[u]),E=h.useCallback(function(a){var b=s.current;switch(a){case"MentionsAutocomplete/cancel":r(!0);break;case"MentionsAutocomplete/select-mention":b&&b.select();break;case"MentionsAutocomplete/previous-mention":b&&b.moveUp();break;case"MentionsAutocomplete/next-mention":b&&b.moveDown();break}return"not-handled"},[]);a=h.useCallback(function(a){var c=e.inputState;if(y==null||c.__type!=="editor-state-based")return;c=b("getCometComposerMentionsSearch")(y);if(c==null){b("recoverableViolation")("Race condition where the user selected a mention but theres no text in the editor","search");return}c=x(c);c=c.searchResult;if(c==null){b("recoverableViolation")("onPressEntry was called and no search result was found for the query","CometComposer");return}t.current=!1;A();var d=b("cometReplaceMentionedTextInEditorState")(a,y,c.replaceableString.length,function(a,c){return b("createCometComposerMentionsEntity")(c.getKey(),!1,a)},function(){return a.getLabel()});g(function(a){return p(a,d)})},[e,x,A,y,g]);var F=h.useRef(null),G=h.useMemo(function(){return b("createUpgradedUFI2MentionsComposerPluginAnchorDecorator")(x,F)},[x]);h.useImperativeHandle(c,function(){return{getUpgradedProps:function(a){var c=a.inputProps;a=babelHelpers.objectWithoutPropertiesLoose(a,["inputProps"]);return babelHelpers["extends"]({},a,{inputProps:babelHelpers["extends"]({},c,{composerState:b("installUFI2ComposerInputDecorators")(c.composerState,G,o,n),handleKeyCommand:function(a){return E(a)},keyBindingFn:function(a){return D(a,c.keyBindingFn)},onBlur:B,onFocus:C})})}}});c=h.useCallback(function(a){w.current=a;if(a)return;A()},[A]);var H=h.useCallback(function(a,b){(a==null||b==null)&&A(),A({"aria-activedescendant":a,"aria-controls":b})},[A]);if(d)return null;d=F.current;if(d==null)return null;var I=x(u),J=I.dataSource;I=I.searchResult;if(I==null||J==null)return null;t.current=!0;return h.jsx(b("CometMentions.react"),{context:d,dataSource:J,onAriaChange:H,onBlur:B,onFocus:C,onResultsUpdated:c,onSelectedEntry:a,position:"below",query:I.matchingString,ref:s,viewItemStrategyRenderer:b("FeedComposerCometMentionsTypeheadListItem.react")})})}return a}}function p(a,c){var d=a.inputState;if(d.__type==="editor-state-based"){c=babelHelpers["extends"]({},a,{inputState:babelHelpers["extends"]({},d,{editorState:c})});return c}b("recoverableViolation")("Unimplemented: tried to commit a searchable entity as a mention to a UFI2ComposerState "+("with an inputState of type "+d.__type+". ")+'Only the "editor-state-based" type is supported at the moment',"search");return a}}),null);